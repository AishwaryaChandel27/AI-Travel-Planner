
{% extends "base.html" %}

{% block title %}Your Itinerary - AI Travel Planner{% endblock %}

{% block content %}
<div class="container">
    <!-- Header -->
    <div class="itinerary-header text-center mb-5">
        <h1 class="display-4">
            <i class="fas fa-map-marked-alt me-3"></i>
            {{ itinerary.title }}
        </h1>
        <p class="lead">{{ itinerary.description }}</p>
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="row text-center">
                    <div class="col-3">
                        <div class="stat-box">
                            <h5 class="text-primary">{{ itinerary.activities|length }}</h5>
                            <small>Days</small>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="stat-box">
                            <h5 class="text-success">${{ itinerary.budget_breakdown.values()|sum|round(2) if itinerary.budget_breakdown else '0' }}</h5>
                            <small>Est. Budget</small>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="stat-box">
                            <h5 class="text-info">{{ itinerary.preference.group_size }}</h5>
                            <small>Travelers</small>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="stat-box">
                            <h5 class="text-warning">{{ weather_info.current.temperature if weather_info else 'N/A' }}°</h5>
                            <small>Weather</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Main Itinerary -->
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-calendar-alt me-2"></i>Daily Itinerary
                    </h5>
                </div>
                <div class="card-body">
                    {% if itinerary.activities %}
                        {% for day_plan in itinerary.activities %}
                        <div class="day-plan mb-4">
                            <h6 class="text-primary border-bottom pb-2">
                                <i class="fas fa-sun me-2"></i>{{ day_plan.day if day_plan.day else 'Day ' + loop.index|string }}
                            </h6>
                            {% if day_plan.activities %}
                                {% for activity in day_plan.activities %}
                                <div class="activity-item d-flex mb-3">
                                    <div class="time-slot text-muted me-3">
                                        {{ activity.time if activity.time else '09:00' }}
                                    </div>
                                    <div class="activity-content flex-grow-1">
                                        <h6 class="mb-1">{{ activity.activity if activity.activity else 'Activity' }}</h6>
                                        <p class="mb-0 text-muted">{{ activity.description if activity.description else 'No description available' }}</p>
                                        {% if activity.duration %}
                                        <small class="text-primary">Duration: {{ activity.duration }}</small>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <p class="text-muted">No activities planned for this day.</p>
                            {% endif %}
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No itinerary available</h5>
                            <p class="text-muted">Please start over with your preferences.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Budget Breakdown -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-dollar-sign me-2"></i>Budget Breakdown
                    </h6>
                </div>
                <div class="card-body">
                    {% if itinerary.budget_breakdown %}
                        {% for category, amount in itinerary.budget_breakdown.items() %}
                        <div class="budget-item d-flex justify-content-between align-items-center mb-2">
                            <span class="text-capitalize">{{ category }}</span>
                            <span class="fw-bold">{{ amount }}</span>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">No budget information available.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Weather Info -->
            {% if weather_info %}
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-cloud-sun me-2"></i>Weather
                    </h6>
                </div>
                <div class="card-body">
                    <div class="text-center">
                        <h4 class="text-primary">{{ weather_info.current.temperature }}°C</h4>
                        <p class="mb-2">{{ weather_info.current.condition }}</p>
                        <small class="text-muted">{{ weather_info.current.description }}</small>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Travel Tips -->
            {% if itinerary.recommendations and itinerary.recommendations.travel_tips %}
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-lightbulb me-2"></i>Travel Tips
                    </h6>
                </div>
                <div class="card-body">
                    {% for tip in itinerary.recommendations.travel_tips %}
                    <div class="alert alert-info py-2">
                        <small>{{ tip }}</small>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Booking Actions -->
            <div class="booking-actions">
                <h6 class="mb-3">
                    <i class="fas fa-shopping-cart me-2"></i>Book Your Trip
                </h6>
                <div class="d-grid gap-2">
                    <a href="{{ url_for('book', booking_type='flights') }}" class="btn btn-outline-primary">
                        <i class="fas fa-plane me-2"></i>Book Flights
                    </a>
                    <a href="{{ url_for('book', booking_type='hotels') }}" class="btn btn-outline-primary">
                        <i class="fas fa-bed me-2"></i>Book Hotels
                    </a>
                    <a href="{{ url_for('book', booking_type='activities') }}" class="btn btn-outline-primary">
                        <i class="fas fa-hiking me-2"></i>Book Activities
                    </a>
                </div>
            </div>>
                                    <div class="time-badge me-3">
                                        <span class="badge bg-primary">{{ activity.time if activity.time else '09:00' }}</span>
                                    </div>
                                    <div class="activity-content">
                                        <h6 class="mb-1">{{ activity.activity if activity.activity else activity.name if activity.name else 'Activity' }}</h6>
                                        <p class="text-muted small mb-1">{{ activity.description if activity.description else 'Enjoy this amazing activity!' }}</p>
                                        <small class="text-info">
                                            <i class="fas fa-clock me-1"></i>{{ activity.duration if activity.duration else '2 hours' }}
                                        </small>
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <p class="text-muted">Activities will be added here.</p>
                            {% endif %}
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-calendar-times text-muted fa-3x mb-3"></i>
                            <h5 class="text-muted">Itinerary is being generated...</h5>
                            <p class="text-muted">Your personalized itinerary will appear here shortly.</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Budget Breakdown -->
            {% if itinerary.budget_breakdown %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-calculator me-2"></i>Budget Breakdown
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for category, amount in itinerary.budget_breakdown.items() %}
                        <div class="col-md-6 mb-3">
                            <div class="d-flex justify-content-between">
                                <span class="text-capitalize">{{ category }}:</span>
                                <strong>${{ amount }}</strong>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between">
                        <h6>Total Estimated Cost:</h6>
                        <h6 class="text-success">${{ itinerary.budget_breakdown.values()|sum|round(2) }}</h6>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Weather Widget -->
            {% if weather_info %}
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-cloud-sun me-2"></i>Weather Forecast
                    </h6>
                </div>
                <div class="card-body">
                    <div class="current-weather text-center mb-3">
                        <h4>{{ weather_info.current.temperature }}°C</h4>
                        <p class="mb-0">{{ weather_info.current.condition }}</p>
                    </div>
                    <div class="forecast">
                        {% for day in weather_info.forecast[:3] %}
                        <div class="d-flex justify-content-between mb-2">
                            <span>{{ day.day }}</span>
                            <span>{{ day.high }}° / {{ day.low }}°</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Recommended Restaurants -->
            {% if itinerary.recommendations and itinerary.recommendations.restaurants %}
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-utensils me-2"></i>Recommended Restaurants
                    </h6>
                </div>
                <div class="card-body">
                    {% for restaurant in itinerary.recommendations.restaurants[:3] %}
                    <div class="restaurant-item mb-3">
                        <h6 class="mb-1">{{ restaurant.name if restaurant.name else 'Local Restaurant' }}</h6>
                        <p class="small text-muted mb-1">{{ restaurant.cuisine if restaurant.cuisine else 'Local Cuisine' }}</p>
                        <span class="badge bg-success">${{ restaurant.price_range if restaurant.price_range else '15-30' }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Travel Tips -->
            {% if itinerary.recommendations and itinerary.recommendations.travel_tips %}
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-lightbulb me-2"></i>Travel Tips
                    </h6>
                </div>
                <div class="card-body">
                    {% for tip in itinerary.recommendations.travel_tips[:3] %}
                    <div class="tip-item mb-2">
                        <small>
                            <i class="fas fa-check-circle text-success me-2"></i>{{ tip }}
                        </small>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Action Buttons -->
            <div class="card">
                <div class="card-body">
                    <h6 class="card-title">
                        <i class="fas fa-ticket-alt me-2"></i>Book Your Trip
                    </h6>
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('book', booking_type='flights') }}" class="btn btn-primary btn-sm">
                            <i class="fas fa-plane me-2"></i>Flights
                        </a>
                        <a href="{{ url_for('book', booking_type='hotels') }}" class="btn btn-success btn-sm">
                            <i class="fas fa-bed me-2"></i>Hotels
                        </a>
                        <a href="{{ url_for('book', booking_type='activities') }}" class="btn btn-info btn-sm">
                            <i class="fas fa-hiking me-2"></i>Activities
                        </a>
                        <a href="{{ url_for('my_bookings') }}" class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-list me-2"></i>My Bookings
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.stat-box {
    padding: 1rem;
    border-radius: 8px;
    background: rgba(0,0,0,0.05);
    margin-bottom: 1rem;
}

.day-plan {
    border-left: 3px solid var(--bs-primary);
    padding-left: 1rem;
}

.activity-item {
    border-bottom: 1px solid rgba(0,0,0,0.1);
    padding-bottom: 1rem;
}

.activity-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.time-badge .badge {
    font-size: 0.75rem;
}
</style>
{% endblock %}
